<?phpclass Areas extends Admin_Controller{	public function __construct(){		parent::__construct();		$this->load->model('areas','areas_db');	}		public function lists(){		$this->load->library('ichar');		$parent_id=$this->input->get('parent_id');		$parent_id=$this->ichar->act($parent_id,'int');		$info=$this->areas_db->get_info($parent_id);		$lists=$this->areas_db->get_query(array('order_by'=>'listorder desc','parent_id'=>$parent_id));		$this->cismarty->assign('lists',$lists);		$this->cismarty->assign('parent_id',$parent_id);		if(isset($info['parent_id'])&&!empty($info['parent_id']))			$this->cismarty->assign('parent_idx',$info['parent_id']);		else			$this->cismarty->assign('parent_idx',0);		$this->cismarty->display('setup/areas/areas_lists.html');	}	public function add(){		if(isset($_POST['dosubmit'])&&!empty($_POST['dosubmit'])){			$input=$_POST['info'];			$datas=array();			if(isset($input['name'])&&!empty($input['name'])){				$datas['name']=$input['name'];			}else{			}			if(isset($input['parent_id'])&&!empty($input['parent_id'])){				$datas['parent_id']=$input['parent_id'];			}else{				$datas['parent_id']=0;			}			if(isset($input['listorder'])&&!empty($input['listorder'])){				$datas['listorder']=$input['listorder'];			}else{			}			$this->areas_db->add($datas);			$this->showmessage('editdialog','操作成功',HTTP_REFERER);		}else{			if(isset($_GET['parent_id'])&&!empty($_GET['parent_id'])){				$parent_id=intval($_GET['parent_id']);			}else{				$parent_id=0;			}			$this->load->helper('areas');			$areas_select=areas_select('info[parent_id]',$parent_id);			$this->cismarty->assign('areas_select',$areas_select);			$this->cismarty->display('setup/areas/areas_add.html');		}	}	public function edit(){		$this->load->library('ichar');		$id=$this->input->get('id');		$id=$this->ichar->act($id,'int');		if(isset($_POST['dosubmit'])&&!empty($_POST['dosubmit'])){			$input=$_POST['info'];			$datas=array();			if(isset($input['name'])&&!empty($input['name'])){				$datas['name']=$input['name'];			}else{			}			if(isset($input['parent_id'])&&!empty($input['parent_id'])){				$datas['parent_id']=$input['parent_id'];			}else{				$datas['parent_id']=0;			}			if(isset($input['listorder'])&&!empty($input['listorder'])){				$datas['listorder']=$input['listorder'];			}else{			}			$this->areas_db->update(array('id'=>$id),$datas);			$this->showmessage('editdialog','操作成功',HTTP_REFERER);		}else{			$info=$this->areas_db->get_info($id);			$this->load->helper('areas');			$parent_id=$info['parent_id'];			$areas_select=areas_select('info[parent_id]',$parent_id);			$this->cismarty->assign('areas_select',$areas_select);			$this->cismarty->assign('info',$info);			$this->cismarty->display('setup/areas/areas_edit.html');		}	}	public function delete(){		if(isset($_GET['id'])&&!empty($_GET['id'])){			$id=intval($_GET['id']);			$this->areas_db->del(array('id'=>$id));			$this->showmessage('error','删除成功',HTTP_REFERER);		}else{			$id=0;			$this->showmessage('success','操作有误',HTTP_REFERER);		}	}}?>